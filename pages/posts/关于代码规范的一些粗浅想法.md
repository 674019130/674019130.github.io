---
title: 关于代码规范的一些粗浅想法
date: 2023-01-05 15:07:18
tags: [代码规范]
categories: [奇奇怪怪的思考]
author: 苏
description: 衡量代码质量的标准有很多——鲁棒性、可读性、复用性、是否符合各种设计原则等等。在我看来，代码规范即衡量代码质量标准的集合。其中可读性可能是代码规范最关注的一部分。
readmore: true
---

# 什么是代码规范？



> “衡量代码质量的唯一标准是阅读该代码时说脏话的次数”。
>
>  ——Robert C. Martin
>
> <img src="https://pica.zhimg.com/80/v2-5d1520afa50157945c15107f4776b850_720w.webp?source=1940ef5c"/>

衡量代码质量的标准有很多——鲁棒性、可读性、复用性、是否符合各种设计原则等等。在我看来，代码规范即衡量代码质量标准的集合。其中**可读性**可能是**代码规范**最关注的一部分。

（当然，上图这种解释或许更容易理解🐶.

# 代码规范的「技能」和「内功」

在我看来，代码规范不是一条条规定，而是属于对业务和技术的思考。很想把自己接触代码以来的所有思考有逻辑地、完整地讲出来，无奈才疏学浅，只能从几个不同的维度独立地对代码规范进行分析。

## 「技能」

「技能」比「内功」更像是一些明文规定的条条框框，更「肉眼可见」。比如模仿英文书写的**标点符号后加一个半角空格**，**条件分支和循环语句的关键字后面加一个半角空格**等等。

在我刚开始入门学习 C/C++ 语言的时候，一个简单的 `for`循环的规范使我困惑了许久。

``` C
for (int i = 0; i < length; ++i)
{
    doSomething();
}
```

为什么`for`关键字后要加一个空格；为什么运算符两边要加空格；为什么大括号要独占一行……还是个新手的我考虑不通这些问题，只能硬记下来，在敲每一个`for`循环时，都手动地添加这一个个不明所以的空格。

很明显，在不明白这种硬性规定背后原因的情况下，身为新手的我也能写出从简单的「空格规范」角度来说算是「规范」的代码，这使我的代码的可读性大大提高——相比于其他同学「粘成一块」的代码。

当然，「技能」远远不止这些，在我们的认知里，几乎所有的**代码规范**都是「技能」，是一些让代码看起来「好看」的硬性规定。在实际工作中，遵守与不遵守它的人，写出来的东西好像都一样可以运行，这无疑让人有点挫败。于是我开始思考为什么这么做。

## 「内功」

我们每个人都能谈一谈空格、换行、变量命名……但所谓的「内功」将不再在这样简单的维度对**代码规范**进行考量，它包罗万象、因人而异而又有一个统一的标准。什么是内功？

当我读《设计模式之禅》这本书的时候，里面提到了许多**面向对象设计原则**：

- 开闭原则 OCP (The Open-Close Principle)
- 单一职责原则 SRP (Single Responsibility Principle)
- [依赖倒置原则](https://www.zhihu.com/search?q=依赖倒置原则&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A1265382883}) DIP (Dependence Inversion Principle)
- 最少知识原则 LKP (Least Knowledge Principle)) / [迪米特法则](https://www.zhihu.com/search?q=迪米特法则&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A1265382883}) (Law Of Demeter)
- 里氏替换原则 LSP (Liskov Substitution Principle)
- 接口隔离原则 ISP (Interface Segregation Principle)
- 组合/聚合复用原则 CARP (Composite/Aggregate Reuse Principle)

面对这些既抽象又合理的原则，我意识到这可能才是衡量代码优劣的更高标准。这使得我们写出的代码可以尽可能符合**高内聚低耦合**的标准。

这也是一种**代码规范**吗？如果你也在追求代码质量，或者你也有代码洁癖，那么毫无疑问，这是一份堪称圭臬的宝藏。

---------------------

除此之外，对「技能」的一些规定的长久的思考，也让我对一些问题有了答案。许多问题都可以用「便于区分」、「模块化」、「尽量避免你所使用的开发语言所拥有的缺陷」等来回答。

还是上面的`for`关键字后加空格的问题，为什么我们在调用一个**函数（方法）**时不需要加空格呢？正是为了区分两者。

为什么在类的公共方法中，调用类的成员方法要添加`this.`前缀，明明不添加也一样可以正常调用。正是为了区分类内方法和其他方法。

……

「内功」对「技能」背后的原因做出了解释，也对其他「技能」所管辖不到的地方提供了**高自由度但「事实一致」**的规范。包括但不限于变量的命名、注释的使用、函数（方法）的职责、类内对象的暴露与封闭……

# 小结

开发工作本身对抽象能力的高要求和工作中业务逻辑的复杂性，对**代码规范**的落地实施设置了许多障碍。在日常工作中，在阅读精炼的源码的时候，甚至在书写相关文档的时候，我们都不应该停止对**产出高质量内容**的追求。或许有人还是对这些「虚无缥缈」的东西不以为意，认为代码和人有一个能跑就行。

Whatever，我们只要一直做酷的事情就好了。

----------------

写的内容并不多，我尝试着总结，尝试一言以蔽之，但是**代码规范**的意义和内容远不止于此。其实，只要在写代码的过程中，保持思考和对技术的追求，对这些东西的理解自然会逐渐提升，自然养成好的习惯。

精益求精，才是我们应该做的。

# 一些常见的、易被忽略的、易于执行的简单规范

有则改之无则加勉。

- 不滥用注释
- 代码不应被注释，如实有必要，应写明注释原因（考虑**注释**的语义）

- 单行注释不应与代码混在一起，且注释应开头空一格

  bad case:

  `this.someMethod(); //some comments`

  good case:

  ```java
  // some comments
  this.someMethod();
  ```
  
- `if`, `for`, `while`, `return`等关键字后空一格，运算符两边各空一格

- 变量命名尽可能使用英文，尽可能简单但意义明确

- 容器类的变量命名包含其语义

  bad case:

  `Map<String, String> score = new HashMap<>();`

  good case:

  `ArrayList<String> fileNameList = new ArrayList<>();`

- 在 Java 代码中尽可能避免传递和返回**空指针**

- 一个代码块应该是一段完整的逻辑，使用换行将代码逻辑模块化

- 一行代码不宜过长

- 尽可能避免出现魔法数，使用常量进行代替，并在注释中写明用途

- 方法参数尽可能少